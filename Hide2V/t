#!/bin/bash
#‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÅ‡∏Å‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡πÉ‡∏ä‡πâ
name="TH17" 
limit=200

[[ -e /etc/openvpn/openvpn-status.log ]] && _onopen=$(grep -c "10.8" /etc/openvpn/openvpn-status.log) || _onopen="0"
[[ -e /etc/default/dropbear ]] && _drp=$(ps aux | grep dropbear | grep -v grep | wc -l) && _ondrp=$(($_drp - 1)) || _ondrp="0"
_onssh=$(ps -x | grep sshd | grep -v root | grep priv | wc -l)

online=$(($_onopen + $_ondrp + $_onssh))

# ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô online
curl --data "name=$name&limit=$limit&online=$online" https://finfin.online/finfin4/txtdb/index.php

# ‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏û‡∏≠‡∏£‡πå‡∏ï 443 (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
sudo pkill -f xray-linu

# ‡πÄ‡∏£‡∏¥‡πà‡∏° OpenVPN ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
if ! systemctl is-active --quiet openvpn; then
  echo "‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏° OpenVPN"
  systemctl start openvpn
else
  echo "üîÑ OpenVPN ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß"
fi
