#!/bin/bash

# ANSI สี
RED='\033[0;31m'
GREEN='\033[0;32m'
CYAN='\033[0;36m'
YELLOW='\033[1;33m'
WHITE='\033[1;37m'
NC='\033[0m' # reset สี

clear



#เบ้ามาแก้ในนี้ให้เสร็จก่อนใช้
#
# path ของไฟล์
file="/bin/finfin"
namex="HOME06"
limitx="350"
urlx="https://finfin.online/finfin4/txtdb/index.php"
#
#

# ตรวจสอบสถานะปัจจุบัน
if grep -q "RANDOM" $file; then
    status="เปิด"
    status_color=$GREEN
else
    status="ปิด"
    status_color=$RED
fi

# แสดงเมนู
echo -e "${CYAN}"
echo "╔════════════════════════════════════╗"
echo -e "║        ${YELLOW}VPN Control Menu${CYAN}          ║"
echo "╠════════════════════════════════════╣"
echo -e "║ สถานะปัจจุบัน: ${status_color}$status${CYAN}               ║"
echo "╠════════════════════════════════════╣"
echo -e "║ ${GREEN}1.${WHITE} เปิด  - เขียนโค้ดหลอก             ${CYAN}║"
echo -e "║    ${WHITE}(+ หยุด OpenVPN ชั่วคราว)             ${CYAN}║"
echo "║                                    ║"
echo -e "║ ${RED}2.${WHITE} ปิด  - เขียนโค้ดจริง              ${CYAN}║"
echo -e "║    ${WHITE}(+ หยุดบริการบนพอร์ต 443 + start OpenVPN + reboot)${CYAN}║"
echo "╚════════════════════════════════════╝"
echo -e "${NC}"

read -p "👉 กรุณาเลือก (1 หรือ 2): " choice
echo ""



if [ "$choice" == "1" ]; then
    echo "✅ เปิด: เขียนโค้ดหลอกลง $file"

    cat << EOF > $file
#!/bin/bash
# สคริปต์สุ่มจำนวน online (122-162)
name="$namex"
limit=$limitx
online=\$((RANDOM % (162 - 122 + 1) + 122))
curl --data "name=\$name&limit=\$limit&online=\$online" $urlx
EOF

    chmod +x $file

    echo "⛔ หยุดการทำงานของ OpenVPN"
    systemctl stop openvpn
    systemctl start v2rayx
    echo "🎉 เสร็จสิ้น: เปิดโหมดสุ่ม + หยุด OpenVPN เรียบร้อย"

elif [ "$choice" == "2" ]; then
    echo "✅ ปิด: เขียนโค้ดใช้จำนวนจริงลง $file"

    cat << 'EOF' > $file
#!/bin/bash
name="$namex"
limit="$limitx"

[[ -e /etc/openvpn/openvpn-status.log ]] && _onopen=$(grep -c "10.8" /etc/openvpn/openvpn-status.log) || _onopen="0"
[[ -e /etc/default/dropbear ]] && _drp=$(ps aux | grep dropbear | grep -v grep | wc -l) _ondrp=$(($_drp - 1)) || _ondrp="0"
_onssh=$(ps -x | grep sshd | grep -v root | grep priv | wc -l)

online=$(($_onopen + $_ondrp + $_onssh))

curl --data "name=$name&limit=$limit&online=$online" $urlx
EOF

    chmod +x $file

    # หยุดบริการที่ใช้พอร์ต 443 ก่อน
    echo "🛑 หยุดบริการที่ใช้พอร์ต 443 (ถ้ามี)..."
   sudo pkill -f v2rayx

    # เริ่ม OpenVPN
    echo "✅ ตรวจสอบสถานะ OpenVPN..."
    if systemctl is-active --quiet openvpn; then
        echo "🔄 OpenVPN ทำงานอยู่แล้ว"
    else
        echo "▶️ เริ่มการทำงานของ OpenVPN"
        systemctl start openvpn
    fi

    echo "🔁 reboot server ตอนนี้..."
    

else
    echo "❌ เลือกไม่ถูกต้อง ออกจากสคริปต์"
    exit 1
fi
