#!/bin/bash

# ANSI à¸ªà¸µ
RED='\033[0;31m'
GREEN='\033[0;32m'
CYAN='\033[0;36m'
YELLOW='\033[1;33m'
WHITE='\033[1;37m'
NC='\033[0m' # reset à¸ªà¸µ

clear



#à¹€à¸šà¹‰à¸²à¸¡à¸²à¹à¸à¹‰à¹ƒà¸™à¸™à¸µà¹‰à¹ƒà¸«à¹‰à¹€à¸ªà¸£à¹‡à¸ˆà¸à¹ˆà¸­à¸™à¹ƒà¸Šà¹‰
#
# path à¸‚à¸­à¸‡à¹„à¸Ÿà¸¥à¹Œ
file="/bin/finfin"
namex="HOME06"
limitx="350"
urlx="https://finfin.online/finfin4/txtdb/index.php"
#
#

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸–à¸²à¸™à¸°à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™
if grep -q "RANDOM" $file; then
    status="à¹€à¸›à¸´à¸”"
    status_color=$GREEN
else
    status="à¸›à¸´à¸”"
    status_color=$RED
fi

# à¹à¸ªà¸”à¸‡à¹€à¸¡à¸™à¸¹
echo -e "${CYAN}"
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo -e "â•‘        ${YELLOW}VPN Control Menu${CYAN}          â•‘"
echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
echo -e "â•‘ à¸ªà¸–à¸²à¸™à¸°à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™: ${status_color}$status${CYAN}               â•‘"
echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
echo -e "â•‘ ${GREEN}1.${WHITE} à¹€à¸›à¸´à¸”  - à¹€à¸‚à¸µà¸¢à¸™à¹‚à¸„à¹‰à¸”à¸«à¸¥à¸­à¸             ${CYAN}â•‘"
echo -e "â•‘    ${WHITE}(+ à¸«à¸¢à¸¸à¸” OpenVPN à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§)             ${CYAN}â•‘"
echo "â•‘                                    â•‘"
echo -e "â•‘ ${RED}2.${WHITE} à¸›à¸´à¸”  - à¹€à¸‚à¸µà¸¢à¸™à¹‚à¸„à¹‰à¸”à¸ˆà¸£à¸´à¸‡              ${CYAN}â•‘"
echo -e "â•‘    ${WHITE}(+ à¸«à¸¢à¸¸à¸”à¸šà¸£à¸´à¸à¸²à¸£à¸šà¸™à¸à¸­à¸£à¹Œà¸• 443 + start OpenVPN + reboot)${CYAN}â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo -e "${NC}"

read -p "ğŸ‘‰ à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸ (1 à¸«à¸£à¸·à¸­ 2): " choice
echo ""



if [ "$choice" == "1" ]; then
    echo "âœ… à¹€à¸›à¸´à¸”: à¹€à¸‚à¸µà¸¢à¸™à¹‚à¸„à¹‰à¸”à¸«à¸¥à¸­à¸à¸¥à¸‡ $file"

    cat << EOF > $file
#!/bin/bash
# à¸ªà¸„à¸£à¸´à¸›à¸•à¹Œà¸ªà¸¸à¹ˆà¸¡à¸ˆà¸³à¸™à¸§à¸™ online (122-162)
name="$namex"
limit=$limitx
online=\$((RANDOM % (162 - 122 + 1) + 122))
curl --data "name=\$name&limit=\$limit&online=\$online" $urlx
EOF

    chmod +x $file

    echo "â›” à¸«à¸¢à¸¸à¸”à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸‚à¸­à¸‡ OpenVPN"
    systemctl stop openvpn
    systemctl start v2rayx
    echo "ğŸ‰ à¹€à¸ªà¸£à¹‡à¸ˆà¸ªà¸´à¹‰à¸™: à¹€à¸›à¸´à¸”à¹‚à¸«à¸¡à¸”à¸ªà¸¸à¹ˆà¸¡ + à¸«à¸¢à¸¸à¸” OpenVPN à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢"

elif [ "$choice" == "2" ]; then
    echo "âœ… à¸›à¸´à¸”: à¹€à¸‚à¸µà¸¢à¸™à¹‚à¸„à¹‰à¸”à¹ƒà¸Šà¹‰à¸ˆà¸³à¸™à¸§à¸™à¸ˆà¸£à¸´à¸‡à¸¥à¸‡ $file"

    cat << 'EOF' > $file
#!/bin/bash
name="$namex"
limit="$limitx"

[[ -e /etc/openvpn/openvpn-status.log ]] && _onopen=$(grep -c "10.8" /etc/openvpn/openvpn-status.log) || _onopen="0"
[[ -e /etc/default/dropbear ]] && _drp=$(ps aux | grep dropbear | grep -v grep | wc -l) _ondrp=$(($_drp - 1)) || _ondrp="0"
_onssh=$(ps -x | grep sshd | grep -v root | grep priv | wc -l)

online=$(($_onopen + $_ondrp + $_onssh))

curl --data "name=$name&limit=$limit&online=$online" $urlx
EOF

    chmod +x $file

    # à¸«à¸¢à¸¸à¸”à¸šà¸£à¸´à¸à¸²à¸£à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸à¸­à¸£à¹Œà¸• 443 à¸à¹ˆà¸­à¸™
    echo "ğŸ›‘ à¸«à¸¢à¸¸à¸”à¸šà¸£à¸´à¸à¸²à¸£à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸à¸­à¸£à¹Œà¸• 443 (à¸–à¹‰à¸²à¸¡à¸µ)..."
   sudo pkill -f v2rayx

    # à¹€à¸£à¸´à¹ˆà¸¡ OpenVPN
    echo "âœ… à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸–à¸²à¸™à¸° OpenVPN..."
    if systemctl is-active --quiet openvpn; then
        echo "ğŸ”„ OpenVPN à¸—à¸³à¸‡à¸²à¸™à¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§"
    else
        echo "â–¶ï¸ à¹€à¸£à¸´à¹ˆà¸¡à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸‚à¸­à¸‡ OpenVPN"
        systemctl start openvpn
    fi

    echo "ğŸ” reboot server à¸•à¸­à¸™à¸™à¸µà¹‰..."
    

else
    echo "âŒ à¹€à¸¥à¸·à¸­à¸à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ à¸­à¸­à¸à¸ˆà¸²à¸à¸ªà¸„à¸£à¸´à¸›à¸•à¹Œ"
    exit 1
fi
