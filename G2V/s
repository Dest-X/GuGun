file="/bin/idcvpn"
echo "‚úÖ ‡∏õ‡∏¥‡∏î: ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ä‡πâ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏•‡∏á $file"

# ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÄ‡∏Å‡πá‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå /bin/ceovpn
cat << 'EOF' > $file
#!/bin/bash
name="TH09"
limit=200

# ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ô OpenVPN (IP ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 10.8.x.x)
[[ -e /etc/openvpn/openvpn-status.log ]] && _onopen=$(grep -c "10.8" /etc/openvpn/openvpn-status.log) || _onopen="0"

# ‡∏ô‡∏±‡∏ö dropbear SSH (‡∏•‡∏ö 1 ‡∏≠‡∏≠‡∏Å ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏≠‡∏≤‡∏à‡∏°‡∏µ process ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á)
[[ -e /etc/default/dropbear ]] && _drp=$(ps aux | grep dropbear | grep -v grep | wc -l); _ondrp=$(($_drp - 1)) || _ondrp="0"

# ‡∏ô‡∏±‡∏ö sshd ‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà root)
_onssh=$(ps -x | grep sshd | grep -v root | grep priv | wc -l)

# ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
online=$(($_onopen + $_ondrp + $_onssh))

# ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
curl --data "name=$name&limit=$limit&online=$online" https://ceovpn.net/24vpn/txtdb/index.php
EOF

# ‡πÉ‡∏´‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏£‡∏±‡∏ô
chmod +x $file

# ‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ xray-linu (‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡∏û‡∏≠‡∏£‡πå‡∏ï 443)
sudo pkill -f v2ryx

# ‡πÄ‡∏£‡∏¥‡πà‡∏° OpenVPN ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
if ! systemctl is-active --quiet openvpn; then
  echo "‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏° OpenVPN"
  systemctl start openvpn
else
  echo "üîÑ OpenVPN ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß"
fi
