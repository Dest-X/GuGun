#!/bin/bash

# ====== ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ======
UUID=$(cat /proc/sys/kernel/random/uuid)
PORT=443
FAKE_HOST="www.speedtest.net"

echo "üõ†Ô∏è ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á V2Ray-core (vless+tcp+no tls) + ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ binary ‡πÄ‡∏õ‡πá‡∏ô v2rayx"

# ====== ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á V2Ray-core (‡∏à‡∏≤‡∏Å V2Fly) ======
bash <(curl -Ls https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)

# ====== ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ binary ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏£‡∏≤‡∏á‡∏ï‡∏±‡∏ß ======
systemctl stop v2ray
mv /usr/local/bin/v2ray /usr/local/bin/v2rayx
mv /usr/local/bin/v2ctl /usr/local/bin/v2ctlx

# ====== ‡πÅ‡∏Å‡πâ systemd ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà ======
sed -i 's|/usr/local/bin/v2ray|/usr/local/bin/v2rayx|g' /etc/systemd/system/v2ray.service
sed -i 's|/usr/local/bin/v2ctl|/usr/local/bin/v2ctlx|g' /etc/systemd/system/v2ray.service

# ====== ‡∏™‡∏£‡πâ‡∏≤‡∏á config.json ======
mkdir -p /usr/local/etc/v2ray

cat > /usr/local/etc/v2ray/config.json << EOF
{
  "inbounds": [
    {
      "port": $PORT,
      "protocol": "vless",
      "settings": {
        "clients": [
          {
            "id": "$UUID",
            "level": 0,
            "email": "vless@fast"
          }
        ],
        "decryption": "none"
      },
      "streamSettings": {
        "network": "tcp",
        "security": "none",
        "tcpSettings": {
          "header": {
            "type": "http",
            "request": {
              "path": ["/"],
              "headers": {
                "Host": ["$FAKE_HOST"]
              }
            }
          }
        }
      }
    }
  ],
  "outbounds": [
    {
      "protocol": "freedom",
      "settings": {}
    }
  ]
}
EOF

# ====== ‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° v2ray ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÉ‡∏´‡πâ‡∏õ‡∏∑‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏á) ======
systemctl daemon-reexec
systemctl daemon-reload
# systemctl start v2ray   <== ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
# systemctl enable v2ray  <== ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î autostart

# ====== ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• ======
IP=$(curl -s ipv4.icanhazip.com)
echo ""
echo "‚úÖ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á V2Ray-core (v2rayx) ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ô"
echo "üåê IP: $IP"
echo "üîë UUID: $UUID"
echo "üì° Port: $PORT"
echo "üî∞ Fake Host: $FAKE_HOST"
echo ""
echo "üîó ‡∏•‡∏¥‡∏á‡∏Å‡πå VLESS:"
echo "vless://$UUID@$IP:$PORT?type=tcp&security=none&path=/%2F&host=$FAKE_HOST&headerType=http#v2rayx"
echo ""
echo "üìå ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:"
echo "üëâ systemctl start v2ray"
echo "üëâ systemctl enable v2ray"
