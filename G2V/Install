#!/bin/bash

# ===============================
# ‚úÖ V2RayX PRO Installer + Menu Support
# ===============================

CONFIG_PATH="/etc/v2rayx"
MENU_PATH="/bin/v"
UUID=$(cat /proc/sys/kernel/random/uuid)
PORT=443
FAKE_HOST="www.speedtest.net"

# ========== Install Required Packages ==========
apt update -y && apt install curl jq -y

# ========== Install V2Ray Core (Xray-core) ==========
curl -Ls https://github.com/XTLS/Xray-core/releases/latest/download/Xray-linux-64.zip -o xray.zip
unzip -qo xray.zip -d /usr/local/bin/
chmod +x /usr/local/bin/xray

# ========== Create Config Directory ==========
mkdir -p $CONFIG_PATH

# ========== Generate config.json ==========
cat << EOF > $CONFIG_PATH/config.json
{
  "log": {
    "access": "$CONFIG_PATH/traffic.log",
    "error": "$CONFIG_PATH/error.log",
    "loglevel": "warning"
  },
  "inbounds": [
    {
      "port": $PORT,
      "protocol": "vless",
      "settings": {
        "clients": [
          {
            "id": "$UUID",
            "level": 0,
            "email": "v2rayx"
          }
        ],
        "decryption": "none"
      },
      "streamSettings": {
        "network": "tcp",
        "security": "none",
        "tcpSettings": {
          "header": {
            "type": "http",
            "request": {
              "headers": {
                "Host": [
                  "$FAKE_HOST"
                ]
              }
            }
          }
        }
      }
    }
  ],
  "outbounds": [
    {
      "protocol": "freedom"
    }
  ]
}
EOF

# ========== Setup Support Files ==========
echo "[{\"id\": \"$UUID\", \"exp\": \"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏\"}]" > $CONFIG_PATH/uuid.json
echo "$FAKE_HOST" > $CONFIG_PATH/fakehost.txt
echo "[{\"port\": $PORT, \"protocol\": \"vless\"}]" > $CONFIG_PATH/port.json
touch $CONFIG_PATH/traffic.log

# ========== Create Service ==========
cat << EOF > /etc/systemd/system/v2rayx.service
[Unit]
Description=V2RayX PRO Service
After=network.target

[Service]
ExecStart=/usr/local/bin/xray -config $CONFIG_PATH/config.json
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reexec
systemctl daemon-reload
systemctl enable v2rayx
systemctl restart v2rayx

# ========== Install Menu to /bin/v ==========
curl -o $MENU_PATH https://raw.githubusercontent.com/Dest-X/GuGun/refs/heads/main/G2V/v?token=GHSAT0AAAAAADIRDV7WZRLBITNNIEP72M5W2EPYCRA
chmod +x $MENU_PATH

clear
IP=$(curl -s ipv4.icanhazip.com)
echo -e "\e[32m‚úÖ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á V2RayX Pro ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\e[0m"
echo -e "üÜî UUID: \e[36m$UUID\e[0m"
echo -e "üåê IP: \e[36m$IP\e[0m"
echo -e "üîê ‡∏û‡∏≠‡∏£‡πå‡∏ï: \e[36m$PORT\e[0m"
echo -e "üéØ Fake Host: \e[36m$FAKE_HOST\e[0m"
echo -e "üìÅ ‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: \e[33mv\e[0m (‡∏û‡∏¥‡∏°‡∏û‡πå v ‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ)"

