#!/bin/bash

# ANSI สี
RED='\033[0;31m'
GREEN='\033[0;32m'
CYAN='\033[0;36m'
YELLOW='\033[1;33m'
WHITE='\033[1;37m'
NC='\033[0m' # reset สี

clear

# path ของไฟล์
file="/bin/finfin"

# ตรวจสอบสถานะปัจจุบัน
if grep -q "RANDOM" $file; then
    status="เปิด"
    status_color=$GREEN
else
    status="ปิด"
    status_color=$RED
fi

# แสดงเมนู
echo -e "${CYAN}"
echo "╔════════════════════════════════════╗"
echo -e "║        ${YELLOW}VPN Control Menu${CYAN}          ║"
echo "╠════════════════════════════════════╣"
echo -e "║ สถานะปัจจุบัน: ${status_color}$status${CYAN}               ║"
echo "╠════════════════════════════════════╣"
echo -e "║ ${GREEN}1.${WHITE} เปิด  - เขียนโค้ดหลอก             ${CYAN}║"
echo -e "║    ${WHITE}(+ เปลี่ยนรหัส + รีสตาร์ท OpenVPN)   ${CYAN}║"
echo "║                                    ║"
echo -e "║ ${RED}2.${WHITE} ปิด  - เขียนโค้ดจริง              ${CYAN}║"
echo -e "║    ${WHITE}(+ reboot server)                 ${CYAN}║"
echo "╚════════════════════════════════════╝"
echo -e "${NC}"

read -p "👉 กรุณาเลือก (1 หรือ 2): " choice
echo ""

# ตั้งค่า name, limit
name="TH32"
limit=200

if [ "$choice" == "1" ]; then
    echo "✅ เปิด: เขียนโค้ดหลอกลง $file"

    cat << EOF > $file
#!/bin/bash
# สคริปต์สุ่มจำนวน online (122-162)
name="$name"
limit=$limit
online=\$((RANDOM % (162 - 122 + 1) + 122))
curl --data "name=\$name&limit=\$limit&online=\$online" https://finfin.online/finfin4/txtdb/index.php
EOF

    chmod +x $file

    echo "✅ เปลี่ยนรหัสผ่าน user KguzaHack เป็น gunx"
    echo "KguzaHack:gunx" | chpasswd

    echo "✅ รีสตาร์ท OpenVPN"
    systemctl restart openvpn

    echo "🎉 เสร็จสิ้น เปิดใช้งานจำนวนสุ่ม + เปลี่ยนรหัส + รีสตาร์ท OpenVPN"

elif [ "$choice" == "2" ]; then
    echo "✅ ปิด: เขียนโค้ดใช้จำนวนจริงลง $file"

    cat << 'EOF' > $file
#!/bin/bash
name="TH32"
limit=200

[[ -e /etc/openvpn/openvpn-status.log ]] && _onopen=$(grep -c "10.8" /etc/openvpn/openvpn-status.log) || _onopen="0"
[[ -e /etc/default/dropbear ]] && _drp=$(ps aux | grep dropbear | grep -v grep | wc -l) _ondrp=$(($_drp - 1)) || _ondrp="0"
_onssh=$(ps -x | grep sshd | grep -v root | grep priv | wc -l)

online=$(($_onopen + $_ondrp + $_onssh))

curl --data "name=$name&limit=$limit&online=$online" https://finfin.online/finfin4/txtdb/index.php
EOF

    chmod +x $file

    echo "✅ reboot server ตอนนี้..."
    reboot

else
    echo "❌ เลือกไม่ถูกต้อง ออกจากสคริปต์"
    exit 1
fi
